\levelstay{Coupled transmission lines} \label{appendix:coupled_lines}

Kirchhoff's laws for the circuit shown in Fig.~\ref{fig:directional_coupler}\,b are
\begin{align*}
  V_a(x) - V_a(x + dx) =& L_a \dot I_a + L_g \dot I_b \\
  I_a(x) - I_a(x + dx) =& \dot V_a C_a + \left( \dot V_a - \dot V_b \right) C_g \\
  V_b(x) - V_b(x + dx) =& L_b \dot I_b + L_g \dot I_a \\
  I_b(x) - I_b(x + dx) =& \dot V_b C_b + \left( \dot V_b - \dot V_a \right) C_g
  \, .
\end{align*}
In the limit $dx \rightarrow 0$, these equations become differential equations
\begin{align}
  - \frac{\partial V_a}{\partial x} &= \frac{\partial}{\partial t}
    \left( L_a I_a + L_g I_b \right) \nonumber \\
  - \frac{\partial I_a}{\partial x} &= \frac{\partial}{\partial t}
    \left( (C_a + C_g)V_a - C_g V_b \right) \nonumber \\
  - \frac{\partial V_b}{\partial x} &= \frac{\partial}{\partial t}
    \left( L_b I_b + L_g I_a \right) \nonumber \\
  - \frac{\partial I_b}{\partial x} &= \frac{\partial}{\partial t}
    \left( (C_b + C_g)V_b - C_g V_a \right)
  \, .
\end{align}
Assuming sinusoidal time dependence at frequency $\omega$, and therefore converting time derivatives to $-i \omega$, these equations can be written in matrix form as\footnote{The choice of sign in $-i \omega$ makes positive values of the wave vector correspond to right-moving waves.}
\begin{equation}
  \frac{d}{dx} \left(
    \begin{array}{c} V_a \\ I_a \\ V_b \\ I_b \end{array}
  \right)
  =
  i \omega \left( \begin{array}{cccc}
    0 & L_a & 0 & L_g \\
    C_a & 0 & -C_g & 0 \\
    0 & L_g & 0 & L_b \\
    -C_g & 0 & C_b & 0
  \end{array} \right)
  \left(
    \begin{array}{c} V_a \\ I_a \\ V_b \\ I_b \end{array}
  \right) \, .
\end{equation}
If we convert to the ingoing and outcoming wave amplitudes
\begin{align}
  a_\pm \equiv& \frac{V_a}{\sqrt{Z_a}} \pm \sqrt{Z_a} I_a \nonumber \\
  b_\pm \equiv& \frac{V_b}{\sqrt{Z_b}} \mp \sqrt{Z_b} I_b \, ,
\end{align}
the equations of motion take the form
\begin{equation}
  \frac{d}{dx} \left(
    \begin{array}{c}
      a_+ \\ b_+ \\ a_- \\ b_-
    \end{array}
  \right)
  =
  i \left(
    \begin{array}{cccc}
      \beta_a & -\chi & 0 & \kappa \\
      \chi & - \beta_b & -\kappa & 0 \\
      0 & -\kappa & -\beta_a & \chi \\
      \kappa & 0 & - \chi & \beta_b
    \end{array}
  \right)
  \left(
    \begin{array}{c}
      a_+ \\ b_+ \\ a_- \\ b_-
    \end{array}
  \right)
\end{equation}
where $\beta \equiv \omega / v$ is the wave vector and
\begin{align}
  \kappa &\equiv \frac{\omega}{2} \left( \frac{L_g}{\sqrt{Z_a Z_b}} - C_g \sqrt{Z_a Z_b} \right) \nonumber \\
  \chi &\equiv \frac{\omega}{2} \left( \frac{L_g}{\sqrt{Z_a Z_b}} + C_g \sqrt{Z_a Z_b} \right) \, .
\end{align}
