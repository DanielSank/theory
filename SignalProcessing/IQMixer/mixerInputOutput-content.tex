\section{Modulation}

When an IQ mixer is used for modulation (up-conversion) a carrier tone is put into the LO port, and modulating signals are put into the I and Q ports. The input tone $\cos ( \Omega t)$ is multiplied by the I channel, a quarter cycle phase shifted copy of the tone $-\sin ( \Omega t)$ is multiplied by the Q channel, and then both results are summed and put out the RF port.

Consider a case where $I=\cos(\omega t + \phi)$ and $Q=\sin(\omega t + \phi)$. The output of the device is then \begin{eqnarray}
s(t) &=& \cos(\Omega t)\cos(\omega t + \phi) - \sin(\Omega t)\sin(\omega t + \phi) \nonumber \\
&=& \frac{1}{2} \left[ \cos([\Omega + \omega]t + \phi) + \cos([\Omega-\omega]t - \phi) \cdots \right. \nonumber \\ 
& & \left. + \cos([\Omega+\omega]t + \phi) - \cos([\Omega-\omega]t-\phi) \right] \label{eq:modulationRaw} \nonumber \\
&=& \cos([\Omega+\omega]t + \phi)
\end{eqnarray}
Think of the incoming $I$ and $Q$ channels as coordinates in an IQ plane. In this picture the inputs we chose form a counter-clockwise rotating circle with frequency $\omega$ and phase $\phi$. As we've computed, this counter-clockwise rotating circle produces a positively detuned sideband at the output of the mixer. The rotation rate of the input IQ signal translates directly to the detuning of the output signal away from the carrier, and the phase of the input circle translates directly to the phase of the output signal. In fact this observation leads us to a really convenient way to remember this result. If we treat the IQ plane as a complex number plane, then the trajectory of our counter-clockwise moving point can be written simply as \begin{equation}
z_{IQ}(t) = \exp[i(\omega t + \phi)] \label{eq:modulationComplexRep} \end{equation}
Then, to recover the output signal, we just multiply by $\exp[i\Omega t]$ and take the real part, \begin{eqnarray}
z(t)\exp[i\Omega t] &=& \exp[i(\omega t + \phi)]\exp[i\Omega t] \\
z(t)\exp[i\Omega t] &=& \exp[i(\Omega+\omega)t + i\phi] \\
\Re \left( z(t)\exp[i\Omega t] \right ) &=& \cos[(\Omega+\omega)t+\phi] \end{eqnarray}

From equation (\ref{eq:modulationRaw}) you can see that if we reverse the orientation of our rotating signal by setting $Q=-\sin(\omega t + \phi)$, the output would have been negatively detuned, and would have had a negative phase shift. This is consistent with our complex representation: the clockwise rotating signal $\cos[\omega t + \phi] - \sin[\omega t + \phi]$ has complex representation $z(t) = \exp[-i(\omega t + \phi)]$. Multiplying by $\exp[i\Omega t]$ and taking the real part gives $\cos[(\omega-\omega)t - \phi]$, which is the correct real signal.

$\textbf{In summary}$, if we view the inputs to the $I$ and $Q$ ports of an IQ mixer as real and imaginary coordinates, then the map between the input and the output signals is \begin{equation}
\exp[i(\omega t + \phi)] \rightarrow \cos[(\Omega+\omega)t + \phi] \end{equation}

\section{Demodulation to baseband}

Consider a high frequency signal $s(t) = \cos [ (\Omega+\omega)t + \phi ]$ coming into the RF port of an IQ mixer. Into the LO port we put $\cos(\Omega t + \delta)$. If we filter away the high frequency part of the outputs, the output of the $I$ port is \begin{eqnarray}
I(t) &=& \cos [ (\Omega + \omega)t + \phi ]\cos [ \Omega t + \delta ] \nonumber \\
&=& \frac{1}{2}\left( \cos [(2\Omega + \omega)t + \phi + \delta ] + \cos [ \omega t + \phi - \delta ] \right) \nonumber \\
&=& \frac{1}{2} \cos [ \omega t + \phi - \delta ] \end{eqnarray}
Similarly the $Q$ port output is \begin{eqnarray}
Q(t) &=& \cos [ (\Omega + \omega)t + \phi ](-1)\sin [ \Omega t + \delta ] \nonumber \\
&=& \frac{1}{2}\left( \sin [(2\Omega + \omega)t + \phi + \delta ] + \sin [ \omega t + \phi - \delta ] \right) \nonumber \\
&=& \frac{1}{2} \sin [ \omega t + \phi - \delta ] \end{eqnarray}

These signals can be though of as the real and imaginary parts of a complex signal \begin{eqnarray}
z(t) &=& \exp \left[i \left( \omega t + \phi - \delta \right) \right] \\
I(t) = \frac{1}{2}\Re z(t) & \quad & Q(t) = \frac{1}{2}\Im z(t) \end{eqnarray}
Note that the phase of the complex signal is the difference between the phase of the high frequency signal and the phase of the local oscillator. Conveniently, we we think of the incoming high frequency signal as the real part of a complex signal \begin{equation}
z_{\textrm{hf}}=\Re \exp \left[ i \left( \Omega + \omega \right)t +\phi \right]  \end{equation}
and the action of the demodulating IQ mixer, plus the low pass filtering, can then be written as multiplication by $\exp \left[ -i( \Omega t + \delta ) \right]$.

\textbf{In summary}, when a high frequency signal at frequency $\Omega+\omega$ and phase $\phi$ is demodulated by an IQ mixer with an LO signal of frequency $\Omega$ and phase $\delta$, the I and Q outputs are given by the real and imaginary parts of \begin{eqnarray}
z(t)_{\textrm{demod}} &=& \underbrace{\exp \left[-i \left( \Omega t + \delta \right) \right]}_{\textrm{effect of mixer}} \underbrace{\exp \left[ i\left( \Omega + \omega \right) t + i \phi \right]}_{\textrm{incoming signal}} \nonumber \\
&=& \exp \left[ i \left( \omega t + \phi-\delta \right) \right] \nonumber \end{eqnarray}

\section{Demodulation to DC}

Now that we have baseband I and Q signals we want to extract the phase and amplitude of the original high frequency signal. Symbolically what we would like to do is multiply our complex baseband signal by $\exp \left[ -i \omega t \right]$ and integrate. The result would be a complex number $A \exp \left[ i \left( \phi - \delta \right) \right]$ with amplitude proportional amplitude of the original signal. Of course, we can't produce complex numbers in real life, but if we work out the real and imaginary parts we can figure out how to emulate the complex algebra by effecting two separate real signal processes.

First express the complex representation of the IF signal in terms of $I(t)$ and $Q(t)$ \begin{equation}
z(t) = I(t) + iQ(t). \end{equation}
Multiplying by the desired exponential gives \begin{align}
z(t) \exp \left(-i \omega t \right) &= \nonumber \\
        & I(t) \cos (\omega t) + Q(t) \sin (\omega t) \nonumber \\
+ i [ - & I(t) \sin (\omega t) + Q(t) \cos (\omega t) ] \end{align}
From this expression we can see that the final $I$ and $Q$ coordinates are given by \begin{eqnarray}
I &=& \sum I(t)\cos(\omega t) + Q(t) \sin(\omega t) \\
Q &=& \sum Q(t)\cos(\omega t) - I(t) \sin(\omega t) \end{eqnarray}
There are thus four integrals that have to be done in the FPGA board to compute the IQ result. Note that since each signal is multiplied and summed with either sine or cosine the data flow can be greatly simplified in the software. In other words, there are four integrals to do, but only two digital functions to generate \footnote{In fact we can use the same lookup table to generate the sine and cosine by offsetting one quarter cycle in the table}.

\section{Demodulation Mixer Imbalance}

What happens if the demodulating mixer has imbalance in the power coming from the I and Q ports? In that case we would get something like \begin{equation}
I(t) = C \cos (\omega t) \quad Q(t) = S \sin (\omega t) \end{equation}
with $C \neq S$. These cannot be represented as the real and imaginary parts of a single exponential. They can be written as the real and imaginary parts of \begin{equation}
A_1 \exp \left[ \omega t \right] + A_2 \exp \left[ -\omega t \right] \end{equation}
as long as \begin{equation}
A_1 + A_2 = C \qquad A_1 - A_2 = S \end{equation}
This means that in a system with imbalanced I and Q ports we will measure false peaks at frequencies mirrored about the carrier from the real signal.
